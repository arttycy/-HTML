<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡”ç½—å åœ Demo</title>
<style>
    body {
    font-family: sans-serif;
    background-color: #9a9ad9;
    display: flex;
    justify-content: center;
    align-items: flex-start; /* å°†å‚ç›´å±…ä¸­å¯¹é½ï¼Œæ”¹ä¸ºâ€œé¡¶éƒ¨å¯¹é½â€ */
    min-height: 100vh;     /* å°† height æ”¹ä¸º min-heightï¼Œå…è®¸å†…å®¹æ’‘å¼€é¡µé¢ */
    margin: 0;
    padding: 40px 0;         /* å¢åŠ ä¸€äº›ä¸Šä¸‹è¾¹è·ï¼Œè®©é•¿é¡µé¢é¡¶éƒ¨å’Œåº•éƒ¨ä¸è´´è¾¹ */
    box-sizing: border-box;  /* ç¡®ä¿ padding ä¸ä¼šå½±å“æ€»é«˜åº¦è®¡ç®— */
}
body {
    /* ... å…¶ä»–æ ·å¼ ... */
    background-image: url('images/background_pic.jpg');
    background-size: cover;       /* ç¡®ä¿èƒŒæ™¯å›¾ç‰‡è¦†ç›–æ•´ä¸ªè§†å£ */
    background-position: center;  /* å›¾ç‰‡å±…ä¸­æ˜¾ç¤º */
    background-repeat: no-repeat; /* ä¸é‡å¤å¹³é“º */
    background-attachment: fixed; /* èƒŒæ™¯å›ºå®šï¼Œä¸éšé¡µé¢æ»šåŠ¨ */
    
    /* ä¸ºäº†ç¡®ä¿å›¾ç‰‡åŠ è½½å‰æœ‰èƒŒæ™¯è‰²ï¼Œæˆ–è€…å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æœ‰å…œåº• */
    background-color: #333; /* æ¨èè®¾ç½®ä¸€ä¸ªä¸å›¾ç‰‡è‰²è°ƒç›¸è¿‘çš„çº¯è‰²ä½œä¸ºå…œåº• */
}
body {
    /* ... ä¸Šé¢è®¾ç½®çš„èƒŒæ™¯å›¾ç‰‡æ ·å¼ ... */
    position: relative; /* å…è®¸åœ¨å…¶ä¸Šå åŠ ä¼ªå…ƒç´  */
    z-index: 1;         /* ç¡®ä¿å…¶ä»–å†…å®¹åœ¨èƒŒæ™¯ä¹‹ä¸Š */
}
body::before { /* åˆ›å»ºä¸€ä¸ªä¼ªå…ƒç´ ä½œä¸ºåŠé€æ˜è’™ç‰ˆ */
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(222, 223, 219, 0.4); /* é»‘è‰²åŠé€æ˜è’™ç‰ˆï¼Œ0.4æ˜¯é€æ˜åº¦ï¼Œå¯è°ƒ */
    z-index: -1; /* ç¡®ä¿è’™ç‰ˆåœ¨å†…å®¹ä¹‹ä¸‹ï¼Œä½†åœ¨èƒŒæ™¯å›¾ç‰‡ä¹‹ä¸Š */
}
    .page-container { background-color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 90%; max-width: 400px; text-align: center; }
    .hidden { display: none; }
    input, select, textarea, button { width: 100%; padding: 10px; margin: 6px 0; box-sizing: border-box; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; transition: border-color 0.3s; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;}
    #birthday { font-size: 12px; }
    input:focus, select:focus, textarea:focus { border-color: #007bff; outline: none; box-shadow: 0 0 0 2px rgba(0,123,255,0.25); }
    input:invalid { border-color: #dc3545; }
    label { display: block; text-align: left; font-weight: bold; margin-top: 15px; }
    button { background-color: #007bff; color: white; cursor: pointer; border: none; }
    button:hover { background-color: #0056b3; }
    #logout-btn { background-color: #6c757d; margin-top: 15px; }
    .result-display { min-height: 200px; max-height: 400px; text-align: left; white-space: pre-wrap; background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; overflow-y: auto; line-height: 1.6; }
    .hint { display: block; text-align: left; font-size: 12px; color: #6c757d; margin-top: 2px; margin-bottom: 10px; }
    /* é€‰ä¸­åŒ…å«æœˆä»½å’Œå¹´ä»½çš„æ•´ä¸ªåŒºåŸŸ */
.flatpickr-months {
    font-size: 10px;   /* <--- æ•´ä½“è°ƒæ•´å­—å· */
    font-weight: normal;  /* è°ƒæ•´å­—é‡ï¼Œæ¯”å¦‚ normal (æ™®é€š) æˆ– 600 (ç¨ç²—) */
    color: #333;       /* è°ƒæ•´æ–‡å­—é¢œè‰² */
}
    #city::placeholder,
    #question::placeholder {
        font-family: sans-serif;     /* 1. ç»Ÿä¸€å­—ä½“ */
        font-size: 14px;             /* 2. ç»Ÿä¸€å­—å· (å’Œè¾“å…¥æ¡†å­—å·ä¸€è‡´) */
        color: #aaa;                  /* 3. ç»Ÿä¸€é¢œè‰² (æ¯”è¾“å…¥çš„æ–‡å­—é¢œè‰²æµ…ä¸€äº›) */
    }
        /* --- æ–°å¢çš„ä¸‰æ¨¡å—å¸ƒå±€æ ·å¼ --- */
    .module {
        margin-bottom: 25px;
        border-top: 1px solid #eee;
        padding-top: 20px;
        text-align: left;
    }
    /* .module h2 {
        text-align: center;
        font-size: 1.4em;
        color: #333;
        margin-top: 0;
        margin-bottom: 20px;
    } */
    
    .card-container {
        display: flex;
        justify-content: space-around;
        gap: 10px;
        flex-wrap: wrap; /* ç§»åŠ¨ç«¯æ¢è¡Œ */
    }
    .tarot-card-item {
        text-align: center;
        flex-basis: 100px; /* æ¯ä¸ªå¡ç‰Œçš„åŸºç¡€å®½åº¦ */
    }
    .tarot-card-image {
        width: 90px;
        height: auto;
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transition: transform 0.3s;
    }
    .tarot-card-image:hover {
        transform: scale(1.05) translateY(-5px);
    }
    .tarot-card-item p {
        font-size: 13px;
        margin-top: 8px;
        font-weight: 500;
        color: #555;
    }
    .card-interpretation {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #f0f0f0;
    }
    .card-interpretation:last-child {
        border-bottom: none;
    }
    .summary-section h4 {
        color: #1a2a4e;
    }
    /* --- è§£å†³ç»“æœå†…å®¹æ˜¾ç¤ºä¸å…¨çš„é—®é¢˜ --- */
    #result-page {
    max-height: 85vh;  /* è®¾ç½®ç»“æœé¡µå¡ç‰‡çš„æœ€å¤§é«˜åº¦ä¸ºè§†çª—é«˜åº¦çš„85%  */
    overflow-y: auto;   /* å½“å†…å®¹è¶…å‡ºæ—¶ï¼Œå¡ç‰‡å†…éƒ¨å‡ºç°å‚ç›´æ»šåŠ¨æ¡ */
    padding-right: 15px; /* (å¯é€‰) å¢åŠ å³å†…è¾¹è·ï¼Œé˜²æ­¢æ»šåŠ¨æ¡å‹ä½æ–‡å­—*/
    font-size: 15px; /* è®¾ç½®ç»“æœé¡µé¢çš„åŸºç¡€å­—ä½“å¤§å° */
    line-height: 1.6; /* å¢åŠ è¡Œé«˜ï¼Œæé«˜å¯è¯»æ€§ */
}

    /* --- å¡ç‰Œæ–‡å­—å’Œæ ‡ç­¾æ ·å¼ä¼˜åŒ– --- */

    /* è°ƒæ•´å¡ç‰Œåå­—çš„æ ·å¼ */
    .tarot-card-item .card-name-display {
        font-size: 15px; /* ç‰Œåç¨å¤§ä¸€ç‚¹ */
        font-weight: 600; /* ç‰ŒååŠ ç²— */
        color: #333; /* æ›´æ·±çš„é¢œè‰² */
        margin-top: 10px; /* ç‰Œåå’Œå›¾ç‰‡ä¹‹é—´å¤šä¸€äº›ç©ºé—´ */
        margin-bottom: 5px; /* ç‰Œåå’Œæ ‡ç­¾ä¹‹é—´ç•™ç©ºé—´ */
        line-height: 1.3;
    }

    /* å¡ç‰Œç±»å‹æ ‡ç­¾çš„åŸºç¡€æ ·å¼ */
    .card-type-tag {
        display: inline-block; /* è®©æ ‡ç­¾åƒä¸€ä¸ªå—çº§å…ƒç´ ä¸€æ ·ï¼Œå¯ä»¥è®¾ç½®padding */
        padding: 4px 10px; /* å¢åŠ å†…è¾¹è· */
        border-radius: 6px; /* å¢åŠ åœ†è§’ */
        font-size: 13px; /* å¢åŠ æ ‡ç­¾å­—ä½“å¤§å° */
        font-weight: 500; /* æ ‡ç­¾å­—ä½“ç²—ç»† */
        line-height: 1; /* è¡Œé«˜ï¼Œç¡®ä¿æ–‡å­—å±…ä¸­ */
        color: #fff; /* æ–‡å­—é¢œè‰²ä¸ºç™½è‰² */
        margin-top: 5px; /* ä¸ç‰Œåä¹‹é—´çš„é—´è· */
        box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* å¢å¼ºé˜´å½±æ•ˆæœï¼Œå¢åŠ ç«‹ä½“æ„Ÿ */
    }

    /* æ­£ä½æ ‡ç­¾çš„ç‰¹å®šé¢œè‰² */
    .card-type-positive {
        background-color: #E8F5E9; /* è¿™æ˜¯ä¸€ä¸ªéå¸¸æŸ”å’Œçš„æ·¡ç»¿è‰² */
        color: #388E3C;           /* è¿™æ˜¯ä¸ä¹‹æ­é…çš„ã€æ›´æ·±ä¸€ç‚¹çš„ç»¿è‰²æ–‡å­—ï¼Œç¡®ä¿æ¸…æ™°å¯è¯» */
    }

    /* é€†ä½æ ‡ç­¾çš„ç‰¹å®šé¢œè‰² */
    .card-type-negative {
        /*background-color: #F44336; çº¢è‰² */
        background-color: #FFEBEE; /* è¿™æ˜¯ä¸€ä¸ªéå¸¸æŸ”å’Œçš„æ·¡çº¢è‰²/ç²‰è‰² */
        color: #D32F2F;           /* è¿™æ˜¯ä¸ä¹‹æ­é…çš„ã€æ›´æ·±ä¸€ç‚¹çš„çº¢è‰²æ–‡å­—ï¼Œç¡®ä¿æ¸…æ™°å¯è¯» */
    }

    /* è°ƒæ•´å¡ç‰Œæ•´ä½“çš„é—´è·ï¼Œé˜²æ­¢æ ‡ç­¾è¢«æŒ¤å‹ */
    .tarot-card-item {
        text-align: center;
        flex-basis: 100px; /* æ¯ä¸ªå¡ç‰Œçš„åŸºç¡€å®½åº¦ */
        min-width: 90px;   /* ç¡®ä¿åœ¨å°å±å¹•ä¸‹ä¹Ÿæœ‰æœ€å°å®½åº¦ */
        padding: 5px;      /* å¢åŠ ä¸€ç‚¹å†…è¾¹è·ï¼Œé¿å…å†…å®¹è¿‡äºè´´è¾¹ */
    }
    /* --- å…¨æ–°é»„è‰²/åœŸé»„è‰²ä¸»é¢˜ --- */

    /* 1. ä¸»è¦æŒ‰é’®å’Œäº¤äº’å…ƒç´ çš„é¢œè‰² */
    button,
    #login-btn,
    #divine-btn {
        background-color: #ff9500; /* å®šä¹‰ä¸»é¢˜è‰²ä¸ºï¼šé»„è‰² */
        transition: background-color 0.3s;
        font-weight: 600; /* è®©æŒ‰é’®æ–‡å­—ç¨ç²—ä¸€ç‚¹ï¼Œæ›´æœ‰è´¨æ„Ÿ */
    }
    button:hover,
    #login-btn:hover,
    #divine-btn:hover {
        background-color: #A0740A; /* é¼ æ ‡æ‚¬åœæ—¶é¢œè‰²åŠ æ·± */
    }
    /* å…¶ä»–ç‰¹æ®ŠæŒ‰é’®å¯ä»¥ä¿æŒç°è‰² */
    #logout-btn { background-color: #b8bdc0; }
    #clear-birthday {
        background-color: #ff9500; /* å’Œâ€œé€€å‡ºç™»å½•â€æŒ‰é’®é¢œè‰²ä¸€è‡´ï¼Œä½œä¸ºé»˜è®¤è‰² */
        color: white;
        cursor: pointer;
        border: none;
        transition: background-color 0.2s, transform 0.1s; /* å¢åŠ è¿‡æ¸¡æ•ˆæœï¼Œè®©å˜åŒ–æ›´å¹³æ»‘ */
    }
    #clear-birthday:active {
    background-color: #5a6268;   /* è¿™æ˜¯æŒ‰ä¸‹æ—¶æ‰ä¼šå˜æˆçš„æ·±ç°è‰² */
}

    /* 2. è¾“å…¥æ¡†èšç„¦æ—¶çš„è¾‰å…‰æ•ˆæœ */
    input:focus, select:focus, textarea:focus {
        border-color: #B8860B; /* è¾¹æ¡†ä¹Ÿä½¿ç”¨ä¸»é¢˜è‰² */
        box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.25); /* åœŸé»„è‰²çš„è¾‰å…‰ */
    }

    /* 3. (å¯é€‰) ä¼˜åŒ–å¡ç‰‡å’Œæ ‡é¢˜é¢œè‰²ä»¥åŒ¹é…ä¸»é¢˜ */
    .page-container {
        background-color: #FAF9F6; /* ä½¿ç”¨ä¸€ä¸ªæ›´æŸ”å’Œçš„ç±³ç™½è‰²ä»£æ›¿çº¯ç™½ï¼Œæ›´æœ‰ç¾Šçš®çº¸çš„æ„Ÿè§‰ */
        border: 1px solid #EAE0B2; /* ç»™å¡ç‰‡ä¸€ä¸ªæ·¡æ·¡çš„é‡‘è‰²è¾¹æ¡† */
    }

    h1, h2 {
        color: #5C523A; /* æ·±æ©„æ¦„/æ£•è‰²æ ‡é¢˜ï¼Œæ¯”çº¯é»‘æ›´æŸ”å’Œ */
    }

    /* --- å»ºè®®æ¨¡å—çš„å¡ç‰‡å¼å¸ƒå±€æ ·å¼ --- */
    .suggestions-container {
        display: flex;
        flex-direction: column; /* å‚ç›´æ’åˆ—å¡ç‰‡ */
        gap: 15px; /* å¡ç‰‡ä¹‹é—´çš„é—´è· */
    }

    .suggestion-card {
        display: flex;
        align-items: flex-start; /* å›¾æ ‡å’Œæ–‡å­—é¡¶éƒ¨å¯¹é½ */
        background-color: #FFFFFF;
        padding: 15px 20px;
        /* ã€åœ†è§’ã€‘ ä½ å¯ä»¥è°ƒæ•´è¿™ä¸ªå€¼ï¼Œæ¯”å¦‚ 12px ä¼šæ›´åœ†æ»‘ */
        border-radius: 12px; 
    
    /* ã€æ¡†çº¿ã€‘ æ·»åŠ ä¸€ä¸ªå®Œæ•´ã€æŸ”å’Œçš„ç°è‰²è¾¹æ¡† */
        border: 1px solid #EAE0B2; /* ä½¿ç”¨ä¸€ä¸ªå’Œä¸»é¢˜è‰²åè°ƒçš„æ·¡é‡‘è‰²è¾¹æ¡† */
        transition: box-shadow 0.3s, border-color 0.3s;

    }
    .suggestion-card:hover {
        box-shadow: 0 4px 12px rgb(251, 232, 198);
    }

    .suggestion-icon {
        font-size: 1.5em; /* å›¾æ ‡å¤§å° */
        margin-right: 15px;
        line-height: 1.4; /* è°ƒæ•´è¡Œé«˜è®©å›¾æ ‡å’Œæ–‡å­—æ›´å¯¹é½ */
    }

    .suggestion-text {
        font-size: 14px;
        line-height: 1.7;
        color: #333;
    }
    /* --- ä¸º H2 æ ‡é¢˜æ·»åŠ å·¦å³å¯¹ç§°çš„è£…é¥°ç¬¦å· --- */

/* ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹ h2 è‡ªèº«çš„æ ·å¼ */
    h2 {
        /* å°†æ ‡é¢˜è‡ªèº«å˜ä¸º Flex å®¹å™¨ */
        display: flex;
        justify-content: center; /* æ°´å¹³å±…ä¸­æ‰€æœ‰å­é¡¹ç›® */
        align-items: center;     /* å‚ç›´å±…ä¸­æ‰€æœ‰å­é¡¹ç›® */
        
        /* åŸæœ‰çš„æ ·å¼å¯ä»¥ä¿ç•™æˆ–å¾®è°ƒ */
        width: 100%;             /* ç¡®ä¿ h2 æ’‘æ»¡å®¹å™¨å®½åº¦ä»¥ä¾¿æ­£ç¡®å±…ä¸­ */
        font-size: 1.5em;
        font-weight: 600;
        color: #483D8B;
        margin-top: 0;
        margin-bottom: 25px;
        border-bottom: none; /* ç§»é™¤ä¹‹å‰å¯èƒ½æ·»åŠ çš„ä¸‹åˆ’çº¿ */
        padding-bottom: 0;   /* ç§»é™¤ä¹‹å‰å¯èƒ½æ·»åŠ çš„å†…è¾¹è· */
    }

    /* ç¬¬äºŒæ­¥ï¼šåŒæ—¶å®šä¹‰å·¦å³ä¸¤ä¸ªç¬¦å·çš„æ ·å¼ */
    h2::before,
    h2::after {
        /* å®šä¹‰ç¬¦å·çš„å†…å®¹ */
        content: 'âœ¦';
        font-size: 18px;
        color: #D4AF37;
        
        /* ä½¿ç”¨ margin åœ¨ç¬¦å·å’Œæ–‡å­—ä¹‹é—´åˆ¶é€ é—´è· */
        margin: 0 15px; /* ä¸Šä¸‹é—´è·ä¸º0ï¼Œå·¦å³é—´è·ä¸º15px */
        
        /* ç”±äºä½¿ç”¨äº†Flexboxï¼Œä¸å†éœ€è¦ position: absolute; ç­‰å®šä½ä»£ç  */
    }

</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    </head>
<body>

    <div id="login-page" class="page-container">
        <h1>æ¬¢è¿æ¥åˆ°å¡”ç½—å°å±‹</h1>
        <p>è¯·è¾“å…¥ä½ çš„æ˜µç§°å¼€å§‹</p>
        <input type="text" id="name-input" placeholder="è¾“å…¥ä½ çš„æ˜µç§°">
        <button id="login-btn">è¿›å…¥</button>
    </div>

    <div id="input-page" class="page-container hidden">
        <h2 id="welcome-message">ä½ å¥½ï¼</h2>
        <p>è¯·å¡«å†™ä½ çš„ä¿¡æ¯ï¼Œè®©å åœæ›´å‡†ç¡®</p>
        <form id="tarot-form">
            <label for="birthday">ä½ çš„ç”Ÿæ—¥:</label>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="birthday" placeholder="è¯·é€‰æ‹©ä½ çš„ç”Ÿæ—¥..." required style="flex: 1;">
                <button type="button" id="clear-birthday" style="width: auto; padding: 12px;">æ¸…é™¤</button>
            </div>
            <span class="hint">è¯·é€‰æ‹©æ‚¨çš„å‡ºç”Ÿæ—¥æœŸ(æ ¼å¼: YYYY-MM-DD)</span>

            <label for="gender">ä½ çš„æ€§åˆ«:</label>
            <select id="gender" required>
                <option value="">è¯·é€‰æ‹©...</option>
                <option value="ç”·">ç”·</option>
                <option value="å¥³">å¥³</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
            </select>

            <label for="city">å‡ºç”ŸåŸå¸‚:</label>
            <input type="text" id="city" placeholder="è¯·è¾“å…¥æ‚¨çš„å‡ºç”ŸåŸå¸‚ï¼Œä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·" required>
            <span class="hint">ç”¨äºå åœæ—¶è€ƒè™‘æ—¶åŒºå’Œç»çº¬åº¦</span>

            <label for="question">ä½ æƒ³è¦å åœçš„é—®é¢˜:</label>
            <textarea id="question" placeholder="ä¾‹å¦‚ï¼šå¸®æˆ‘å åœä¸€ä¸‹äº‹ä¸šè¿åŠ¿å§ã€‚" rows="4" required minlength="5" maxlength="200"></textarea>
            <span class="hint">è¯·è¾“å…¥æ‚¨æƒ³å åœçš„é—®é¢˜ (<span id="char-count">0</span>/200 å­—ç¬¦)</span>

            <button type="submit" id="divine-btn">å¼€å§‹å åœ</button>
        </form>
        <button id="logout-btn">é€€å‡ºç™»å½•</button>
    </div>

    <div id="result-page" class="page-container hidden">
    <h1>å åœç»“æœ</h1>
    <div id="loading-message" style="text-align: center; padding: 20px; font-size: 16px;">
        <p>æ­£åœ¨ä¸ºä½ è¿æ¥æ˜Ÿè¾°ï¼Œè§£è¯»ç‰Œé˜µï¼Œè¯·ç¨å€™...</p>
    </div>
    <div id="result-modules" style="display: none;">
        <div id="module-cards" class="module">
            <h2>ä½ æŠ½åˆ°çš„ç‰Œ</h2>
            <div id="card-display-area" class="card-container">
                </div>
        </div>

        <div id="module-interpretations" class="module">
            <h2>ç‰Œé¢è§£è¯»</h2>
            <div id="interpretation-area">
                </div>
        </div>

        <div id="module-summary" class="module">
            <h2>ç»¼åˆåˆ†æä¸å»ºè®®</h2>
            <div id="summary-area">
                </div>
        </div>
    </div>

    <button id="back-btn">è¿”å›å†é—®ä¸€æ¬¡</button>
</div>

<script src="config.js"></script>
<script>
    // --- å…ƒç´ è·å– ---
    const loginPage = document.getElementById('login-page');
    const inputPage = document.getElementById('input-page');
    const resultPage = document.getElementById('result-page');
    // ç™»å½•é¡µå…ƒç´ 
    const nameInput = document.getElementById('name-input');
    const loginBtn = document.getElementById('login-btn');
    // è¾“å…¥é¡µå…ƒç´ 
    const welcomeMessage = document.getElementById('welcome-message');
    const tarotForm = document.getElementById('tarot-form');
    const birthdayInput = document.getElementById('birthday');
    const genderSelect = document.getElementById('gender');
    const cityInput = document.getElementById('city');
    const questionTextarea = document.getElementById('question');
    const logoutBtn = document.getElementById('logout-btn');
    // ç»“æœé¡µå…ƒç´ 
    /*const resultDisplay = document.getElementById('result-display'); */
    const backBtn = document.getElementById('back-btn');

    // --- é¡µé¢åˆ‡æ¢é€»è¾‘ ---
    function showPage(page) {
        loginPage.classList.add('hidden');
        inputPage.classList.add('hidden');
        resultPage.classList.add('hidden');
        page.classList.remove('hidden');
    }

    // --- æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    function checkLogin() {
        const name = localStorage.getItem('tarotUserName');
        if (name) {
            welcomeMessage.innerText = `ä½ å¥½ï¼Œ${name}ï¼`;
            showPage(inputPage);
        } else {
            showPage(loginPage);
        }
    }
    // åˆå§‹åŒ–ç”Ÿæ—¥é€‰æ‹©å™¨
    flatpickr("#birthday", {
        dateFormat: "Y-m-d",
        maxDate: "today",
        defaultDate: "1990-01-01",
        allowInput: false,
        locale: {
            weekdays: {
                shorthand: ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'],
                longhand: ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­']
            },
            months: {
                shorthand: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
                longhand: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ']
            },
            firstDayOfWeek: 1,
            rangeSeparator: ' è‡³ ',
            weekAbbreviation: 'å‘¨',
            scrollTitle: 'æ»šåŠ¨åˆ‡æ¢',
            toggleTitle: 'ç‚¹å‡»åˆ‡æ¢ 12/24 å°æ—¶æ—¶åˆ¶'
        }
    });
    
    // ç™»å½•
    loginBtn.addEventListener('click', () => {
        const name = nameInput.value.trim();
        if (name) {
            localStorage.setItem('tarotUserName', name);
            checkLogin();
        } else {
            alert('æ˜µç§°ä¸èƒ½ä¸ºç©ºï¼');
        }
    });

    // é€€å‡ºç™»å½•
    logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('tarotUserName');
        checkLogin();
    });
    
    // è®¾ç½®ç”Ÿæ—¥è¾“å…¥çš„æœ€å¤§æ—¥æœŸä¸ºä»Šå¤©
    const today = new Date().toISOString().split('T')[0];
    birthdayInput.max = today;
    
    // æ¸…é™¤ç”Ÿæ—¥æŒ‰é’®äº‹ä»¶
    document.getElementById('clear-birthday').addEventListener('click', () => {
        birthdayInput._flatpickr.clear();
    });
    
    // æäº¤å åœä¿¡æ¯
    tarotForm.addEventListener('submit', (event) => {
        event.preventDefault(); // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤è¡Œä¸º
        
        // éªŒè¯ç”Ÿæ—¥æ—¥æœŸä¸èƒ½è¶…è¿‡ä»Šå¤©
        if (birthdayInput.value > today) {
            alert('ç”Ÿæ—¥ä¸èƒ½è¶…è¿‡ä»Šå¤©ï¼');
            return;
        }
        
        const userData = {
            name: localStorage.getItem('tarotUserName'),
            birthday: birthdayInput.value,
            gender: genderSelect.value,
            city: cityInput.value,
            question: questionTextarea.value
        };
        performDivination(userData);
    });

    // è¿”å›æŒ‰é’®
    backBtn.addEventListener('click', () => {
        showPage(inputPage);
    });
    
    // é—®é¢˜è¾“å…¥æ¡†å­—ç¬¦è®¡æ•°
    questionTextarea.addEventListener('input', () => {
        const charCount = questionTextarea.value.length;
        document.getElementById('char-count').textContent = charCount;
        
        // å½“å­—ç¬¦æ•°æ¥è¿‘é™åˆ¶æ—¶æ”¹å˜é¢œè‰²
        const countElement = document.getElementById('char-count');
        if (charCount > 180) {
            countElement.style.color = '#dc3545';
        } else if (charCount > 150) {
            countElement.style.color = '#ffc107';
        } else {
            countElement.style.color = '#6c757d';
        }
    });


// è°ƒç”¨ Agent API è¿›è¡Œå åœ
// â–¼â–¼â–¼ æ›¿æ¢æ—§çš„ performDivination å‡½æ•° â–¼â–¼â–¼
async function performDivination(userData) {
    showPage(resultPage);
    // æ˜¾ç¤ºåŠ è½½æ¶ˆæ¯ï¼Œéšè—ç»“æœæ¨¡å—
    document.getElementById('loading-message').style.display = 'block';
    document.getElementById('result-modules').style.display = 'none';

    const headers = {
        'Authorization': YOUR_ACCESS_TOKEN,
        'Content-Type': 'application/json'
    };
    const body = {
        workflow_id: YOUR_WORKFLOW_ID,
        parameters: {
            birthday: userData.birthday,
            gender: userData.gender,
            city: userData.city,
            question: userData.question
        },
        user_id: userData.name || 'default_user'
    };
    // ... (ä½ å·²æœ‰çš„æ„å»º body çš„ä»£ç ä¿æŒä¸å˜)

    try {
        const response = await fetch('https://api.coze.cn/v1/workflow/run', {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(body)
        });

        if (!response.ok) throw new Error(`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${response.status}`);

        const result = await response.json();
        console.log('ä» Coze API æ”¶åˆ°çš„å®Œæ•´å“åº”:', result);

        if (result.code !== 0) throw new Error(`API é”™è¯¯: ${result.msg}`);

        // --- å…¨æ–°æ¸²æŸ“é€»è¾‘ ---
        
        // 1. æ¸…ç†å¹¶è§£ææœ€ç»ˆçš„ JSON æ•°æ®
        // Coze è¿”å›çš„ output æ˜¯ä¸€ä¸ªåŒ…å« ```json ... ``` çš„å­—ç¬¦ä¸²
        let jsonString = JSON.parse(result.data).output;
        // ç§»é™¤ Markdown çš„ä»£ç å—æ ‡è®°
        jsonString = jsonString.replace(/^```json\n/, '').replace(/\n```$/, '');
        const finalData = JSON.parse(jsonString);
        console.log('æœ€ç»ˆç”¨äºæ¸²æŸ“é¡µé¢çš„ç»“æ„åŒ–æ•°æ®:', finalData);

        // 2. æ¸²æŸ“æ¨¡å—ä¸€ï¼šæŠ½å–çš„å¡ç‰Œ
        /* const cardArea = document.getElementById('card-display-area');
        cardArea.innerHTML = finalData.drawn_cards.map(card => `
            <div class="tarot-card-item">
                <img src="${card.image_url}" alt="${card.name} - ${card.type}" class="tarot-card-image">
                <p>${card.type}çš„<br>${card.name}</p>
            </div>
        `).join('');
        */
        const cardArea = document.getElementById('card-display-area');
        cardArea.innerHTML = finalData.drawn_cards.map(card => {
            // æ ¹æ®ç‰Œçš„ç±»å‹å†³å®šæ ‡ç­¾çš„é¢œè‰²
            const typeClass = card.type === 'æ­£ä½' ? 'card-type-positive' : 'card-type-negative';
            // å®Œæ•´çš„ç‰Œåï¼Œä¸åŒ…å«æ­£é€†ä½ï¼ˆå› ä¸ºæ­£é€†ä½ä¼šå•ç‹¬åšæˆæ ‡ç­¾ï¼‰
            const cardNameOnly = card.name; 

            return `
                <div class="tarot-card-item">
                    <img src="${card.image_url}" alt="${card.type}çš„${cardNameOnly}" class="tarot-card-image">
                    <p class="card-name-display">${cardNameOnly}</p>
                    <span class="card-type-tag ${typeClass}">${card.type}</span>
                </div>
            `;
        }).join('');

        // 3. æ¸²æŸ“æ¨¡å—äºŒï¼šå¡ç‰Œè§£è¯»
        const interpretationArea = document.getElementById('interpretation-area');
        interpretationArea.innerHTML = finalData.interpretations.map(interp => `
            <div class="card-interpretation">
                <h4>ğŸƒ ${interp.type}çš„${interp.card_name}</h4>
                <p><strong>ğŸ’¡ ç‰Œé¢å«ä¹‰:</strong> ${interp.meaning}</p>
                <p><strong>ğŸ“‹ ç»“åˆæ˜Ÿç›˜åˆ†æ:</strong> ${interp.analysis}</p>
            </div>
        `).join('');

        // 4. æ¸²æŸ“æ¨¡å—ä¸‰ï¼šç»¼åˆåˆ†æä¸å»ºè®®
        const summaryArea = document.getElementById('summary-area');
        if (finalData.summary) {
            // é¦–å…ˆæ¸²æŸ“åˆ†æéƒ¨åˆ†
            let summaryHtml = `
                <div class="summary-section">
                    <h4>æ˜Ÿç›˜ç»¼åˆæç¤º</h4>
                    <p>${finalData.summary.star_chart_analysis}</p>
                    <h4>æ•´ä½“åˆ†æ</h4>
                    <p>${finalData.summary.comprehensive_analysis}</p>
                    <h4>ç»™ä½ çš„å»ºè®®</h4>
                </div>
            `;

        // ç„¶åï¼Œéå† suggestions æ•°ç»„æ¥åˆ›å»ºå¡ç‰‡
        const suggestionsHtml = finalData.summary.suggestions.map(sugg => `
            <div class="suggestion-card">
                <div class="suggestion-icon">${sugg.icon}</div>
                <div class="suggestion-text">${sugg.advice}</div>
            </div>
        `).join('');

        // å°†åˆ†æå’Œå»ºè®®å¡ç‰‡ç»„åˆèµ·æ¥
        summaryArea.innerHTML = summaryHtml + `<div class="suggestions-container">${suggestionsHtml}</div>`;
}
        // éšè—åŠ è½½æ¶ˆæ¯ï¼Œæ˜¾ç¤ºç»“æœæ¨¡å—
        document.getElementById('loading-message').style.display = 'none';
        document.getElementById('result-modules').style.display = 'block';

        console.log('å·¥ä½œæµæ‰§è¡ŒæˆåŠŸ!', result);
        console.log('è°ƒè¯•é“¾æ¥:', result.debug_url);

    } catch (error) {
        console.error('å åœæ—¶å‡ºé”™:', error);
        // éšè—åŠ è½½æ¶ˆæ¯ï¼Œæ˜¾ç¤ºç»“æœæ¨¡å—
        document.getElementById('loading-message').style.display = 'none';
        document.getElementById('result-modules').style.display = 'block';
        // å¦‚æœå‡ºé”™ï¼Œåªåœ¨è§£è¯»åŒºæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        document.getElementById('interpretation-area').innerHTML = `<p>å‡ºç°äº†ä¸€ä¸ªé”™è¯¯ï¼š<br>${error.message}<br>è¯·æ£€æŸ¥ä»¤ç‰Œå’Œç½‘ç»œåé‡è¯•ã€‚</p>`;
    }
}
/*
async function performDivination(userData) {
    showPage(resultPage);
    resultDisplay.innerText = 'æ­£åœ¨ä¸ºä½ è¿æ¥æ˜Ÿè¾°ï¼Œè§£è¯»ç‰Œé˜µï¼Œè¯·ç¨å€™...';
    // ---- æ ¹æ® Coze API æ–‡æ¡£æ„å»ºè¯·æ±‚ ----
    // 1. æ„å»ºè¯·æ±‚å¤´ (Headers)
    const headers = {
        'Authorization': YOUR_ACCESS_TOKEN,
        'Content-Type': 'application/json'
    };

    // 2. æ„å»ºè¯·æ±‚ä½“ (Body)
    const body = {
        workflow_id: YOUR_WORKFLOW_ID,
        parameters: {
            birthday: userData.birthday,
            gender: userData.gender,
            city: userData.city,
            question: userData.question
        },
        // Coze API è¦æ±‚æœ‰ä¸€ä¸ª user_id æ¥åŒºåˆ†ç”¨æˆ·
        user_id: userData.name || 'default_user' 
    };

    // 3. ä½¿ç”¨ fetch å‘é€ç½‘ç»œè¯·æ±‚
Â  Â  try {
Â  Â  Â  Â  const response = await fetch('https://api.coze.cn/v1/workflow/run', {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: headers,
Â  Â  Â  Â  Â  Â  body: JSON.stringify(body)
Â  Â  Â  Â  });

Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  throw new Error(`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`);
Â  Â  Â  Â  }

Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  console.log('ä» Coze API æ”¶åˆ°çš„å®Œæ•´å“åº”:', result);
Â  Â  Â  Â  if (result.code !== 0) {
Â  Â  Â  Â  Â  Â  throw new Error(`API é”™è¯¯: ${result.msg}`);
Â  Â  Â  Â  }
        const workflowResult = result.data; // ä» result.data è·å–æ•°æ®
Â  Â  Â  Â  let finalAnswer = '';
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const parsedData = JSON.parse(workflowResult);
Â  Â  Â  Â  Â  Â  finalAnswer = parsedData.output; // ä»è§£åŒ…åçš„æ•°æ®é‡Œè·å– output
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  finalAnswer = workflowResult;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!finalAnswer) {
Â  Â  Â  Â  Â  Â  finalAnswer = 'å·¥ä½œæµæ‰§è¡ŒæˆåŠŸï¼Œä½†æœªèƒ½è¿”å›æœ‰æ•ˆç»“æœã€‚';
Â  Â  Â  Â  }
Â  Â  Â  Â  resultDisplay.innerHTML = marked.parse(finalAnswer);
Â  Â  Â  Â  console.log('å·¥ä½œæµæ‰§è¡ŒæˆåŠŸ!', result);
Â  Â  Â  Â  console.log('è°ƒè¯•é“¾æ¥:', result.debug_url);

Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('å åœæ—¶å‡ºé”™:', error);
Â  Â  Â  Â  resultDisplay.innerText = `å‡ºç°äº†ä¸€ä¸ªé”™è¯¯ï¼š\n${error.message}\nè¯·æ£€æŸ¥ä»¤ç‰Œå’Œç½‘ç»œåé‡è¯•ã€‚`;
Â  Â  }
}
*/

    // --- åˆå§‹åŒ– ---
    // é¡µé¢åŠ è½½æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ç™»å½•çŠ¶æ€
    checkLogin();

</script>
    </body>
</html>
